# Configurable aichat command variables
AI_EXECUTE="$HOME/aichat -e"
AI_CHAT="$HOME/aichat"

# Use aichat to handle unknown commands
command_not_found_handler() {
   $AI_EXECUTE "$@"
}

# Explain a command using aichat
explain() {
    $AI_CHAT "$@"
}

# Same as explain, but allows 'explain:' syntax
explain:() {
    $AI_CHAT "$@"
}

# ZLE widget: send current buffer to aichat and replace with result
_aichat_zsh() {
    if [[ -n "$BUFFER" ]]; then
        local _old=$BUFFER
        BUFFER+="âŒ›"
        zle -I && zle redisplay
        BUFFER=$($AI_EXECUTE "$_old")
        zle end-of-line
    fi
}
zle -N _aichat_zsh

# Keybindings for _aichat_zsh:
#   Alt-e in emacs mode, vi insert mode, and vi command mode
bindkey '\ee' _aichat_zsh
bindkey -M viins '\ee' _aichat_zsh
bindkey -M vicmd '\ee' _aichat_zsh

